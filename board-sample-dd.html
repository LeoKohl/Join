<!DOCTYPE html>
<html lang="de">
	<head>
		<meta charset="UTF-8" />
		<title>Kanban Board Sample (Board.html Style)</title>
		<link rel="stylesheet" href="./styles/board.css" />
		<link rel="stylesheet" href="./styles/side_menu.css" />
		<link rel="stylesheet" href="./styles/global.css" />
		<link rel="stylesheet" href="./styles/standard.css" />
		<link rel="stylesheet" href="./styles/colors.css" />
		<link rel="stylesheet" href="./styles/media-query-board.css" />
		<script src="./scripts/board.js"></script>
		<script src="./scripts/input.js"></script>
		<script src="./scripts/firebase.js"></script>
		<script src="./scripts/side-menu.js"></script>
		<style>
			.drag-board {
				display: grid;
				grid-template-columns: repeat(4, 1fr);
				gap: 20px;
			}
			.board-column {
				display: flex;
				flex-direction: column;
				gap: 10px;
				padding: 10px;
				border-radius: 8px;
				min-height: 600px;
			}
			.column-header {
				font-weight: bold;
				text-align: center;
				margin-bottom: 10px;
			}
			.tasks-list {
				display: flex;
				flex-direction: column;
				gap: 10px;
				flex: 1;
				min-height: 100px;
			}
			.task {
				width: 252px;
				height: 80px;
				background: white;
				border: 1px solid #ccc;
				border-radius: 8px;
				display: flex;
				justify-content: center;
				align-items: center;
				cursor: default;
				justify-self: center;
				margin: 0 auto;
			}
			.placeholder {
				width: 252px;
				height: 80px;
				border: 1px dashed grey;
				background: rgba(200, 200, 200, 0.2);
				justify-self: center;
				margin: 0 auto;
			}
			.empty-msg {
				color: #888;
				font-style: italic;
				text-align: center;
				justify-self: center;
			}
		</style>
	</head>
	<body onload="loadTasksFromFirebase()">
		<header>
			<!--Header content-->
			<div class="header-content">
				<div class="header-inner">
					<div class="logo-mobile d_none">
						<img src="./assets/img/logo/logo-dark.png" alt="Logo" />
					</div>
					<h1 class="header-title">Kanban Project Management Tool</h1>
					<div class="header-right">
						<div class="help-container" id="helpContainer">
							<a href="./help.html" class="help-icon">
								<img
									src="./assets/img/icons/header-side-menu/help.png"
									alt="Help Icon" />
							</a>
						</div>
						<div class="profile-container" id="profileContainer">
							<button
								class="profile-btn"
								onclick="toggleProfileDropdown()"
								aria-label="Profile menu">
								WM
							</button>
							<div id="profileDropdown" class="profile-dropdown">
								<a href="../help.html" class="dropdown-item mobile-only d_none"
									>Help</a
								>
								<a href="./legal-notice.html" class="dropdown-item"
									>Legal Notice</a
								>
								<a href="./privacy-policy.html" class="dropdown-item"
									>Privacy Policy</a
								>
								<a href="index.html" class="dropdown-item">Log out</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</header>
		<!--End of Header content-->
		<!--Side-menu-->
		<aside class="side-menu background-side-menu">
			<div class="logo-section">
				<img
					src="./assets/img/logo/logo-light.png"
					alt="Logo"
					class="logo-side-menu-img" />
			</div>

			<div class="menu-section">
				<a href="./summary.html" class="menu-item">
					<span class="menu-icon">
						<img src="./assets/img/icons/header-side-menu/summary.svg" alt="" />
					</span>
					<span>Summary</span>
				</a>
				<a href="./add-task.html" class="menu-item">
					<span class="menu-icon">
						<img
							src="./assets/img/icons/header-side-menu/add-task.svg"
							alt="" />
					</span>
					<span>Add Task</span>
				</a>
				<a href="./board.html" class="menu-item active">
					<span class="menu-icon">
						<img src="./assets/img/icons/header-side-menu/board.svg" alt="" />
					</span>
					<span>Board</span>
				</a>
				<a href="./add_contact.html" class="menu-item">
					<span class="menu-icon">
						<img
							src="./assets/img/icons/header-side-menu/contacts.svg"
							alt="" />
					</span>
					<span>Contacts</span>
				</a>
			</div>

			<div class="notice-side-menu">
				<a href="./legal-notice.html" class="menu-item menu-bottom">
					<span>Legal notice</span>
				</a>
				<a href="./privacy-policy.html" class="menu-item menu-bottom">
					<span>Privacy Policy</span>
				</a>
			</div>
		</aside>
		<!--End of Side-menu-->
		<main class="main-content">
			<section>
				<div class="header-board">
					<div class="header-title-container">
						<h1>Board</h1>
					</div>
					<div class="search-add-container">
						<div class="search-input-wrapper">
							<input type="text" id="searchInput" placeholder="Find Task" />
							<img
								class="search-divider"
								src="./assets/img/icons/board/search-line.svg"
								alt="|" />
							<button
								type="button"
								class="search-icon-btn"
								onclick="onSearchClick()">
								<img
									class="search-icon"
									src="./assets/img/icons/board/search.svg"
									alt="Search" />
							</button>
						</div>
						<button
							class="add-task-button"
							id="addTaskButton"
							onclick="showAddTask()">
							Add Task
							<img src="./assets/img/icons/board/add-task.svg" alt="" />
						</button>
					</div>
					<button
						class="plus-add-task-button"
						id="plusAddTaskButton"
						onclick="showAddTask()"
						style="display: none"
						aria-label="Add Task">
						<img
							src="./assets/img/icons/board/plus-add-task-mobile.svg"
							alt="Add Task" />
					</button>
				</div>
			</section>
			<!-- <section> -->
			<!-- <div class="drag-board">
          <div class="board-column" id="open">
            <div class="column-header">
              <span>To do</span>
              <button class="add-board-btn" onclick="addBoardTask('open')">
                <img src="./assets/img/icons/board/add-board.svg" alt="Add" />
              </button>
            </div>
            <div class="tasks-list" id="tasks-list-open"></div>
          </div>
          <div class="board-column" id="inprogress">
            <div class="column-header">
              <span>In progress</span>
              <button class="add-board-btn" onclick="addBoardTask('inprogress')">
                <img src="./assets/img/icons/board/add-board.svg" alt="Add" />
              </button>
            </div>
            <div class="tasks-list" id="tasks-list-inprogress"></div>
          </div>
          <div class="board-column" id="awaitfeedback">
            <div class="column-header">
              <span>Await feedback</span>
              <button class="add-board-btn" onclick="addBoardTask('awaitfeedback')">
                <img src="./assets/img/icons/board/add-board.svg" alt="Add" />
              </button>
            </div>
            <div class="tasks-list" id="tasks-list-awaitfeedback"></div>
          </div>
          <div class="board-column" id="done">
            <div class="column-header">
              <span>Done</span>
            </div> -->

			<div class="drag-board">
				<div class="board-column" id="open" data-index="0">
					<div class="column-header">To do</div>
					<div class="tasks-list" id="tasks-list-open">
						<div class="task" draggable="true">Task A</div>
						<div class="task" draggable="true">Task B</div>
						<div class="empty-msg">no tasks to do</div>
					</div>
				</div>
				<div class="board-column" id="inprogress" data-index="1">
					<div class="column-header">In progress</div>
					<div class="tasks-list" id="tasks-list-inprogress">
						<div class="empty-msg">no tasks in progress</div>
					</div>
				</div>
				<div class="board-column" id="awaitfeedback" data-index="2">
					<div class="column-header">Await feedback</div>
					<div class="tasks-list" id="tasks-list-awaitfeedback">
						<div class="empty-msg">no tasks await feedback</div>
					</div>
				</div>
				<div class="board-column" id="done" data-index="3">
					<div class="column-header">Done</div>
					<div class="tasks-list" id="tasks-list-done">
						<div class="task" draggable="true">Task C</div>
						<div class="empty-msg">no tasks done</div>
					</div>
				</div>
			</div>
		</main>

		<script>
			let dragged = null;
			let placeholderTemplate = document.createElement("div");
			placeholderTemplate.className = "placeholder";

			// Funktion zum Prüfen ob eine Spalte leer ist
			function updateEmptyMessages() {
				document.querySelectorAll(".tasks-list").forEach((list) => {
					// Tasks zählen (ohne placeholder)
					const tasks = Array.from(list.children).filter((c) =>
						c.classList.contains("task")
					);
					let msg = list.querySelector(".empty-msg");
					if (tasks.length === 0) {
						if (msg) msg.classList.remove("d-none");
					} else {
						msg.classList.add("d-none");
					}
				});
			}

			// Initial prüfen
			updateEmptyMessages();

			// Drag Events für Tasks
			document.querySelectorAll(".task").forEach((task) => {
				task.addEventListener("dragstart", (e) => {
					dragged = task;
					setTimeout(() => (task.style.display = "none"), 0);

					// Placeholder und .empty-msg in benachbarten Spalten anzeigen/verstecken
					let fromCol = task.closest(".board-column");
					let fromIdx = parseInt(fromCol.dataset.index);
					document.querySelectorAll(".board-column").forEach((col, idx) => {
						if (Math.abs(idx - fromIdx) === 1) {
							let list = col.querySelector(".tasks-list");
							if (!list.querySelector(".placeholder")) {
								list.appendChild(placeholderTemplate.cloneNode(true));
							}
							let msg = list.querySelector(".empty-msg");
							if (msg) msg.style.display = "none";
						}
					});
					// Auch im Ursprungsbereich .empty-msg verstecken, falls nach Drag alle Tasks weg wären
					// let fromList = fromCol.querySelector(".tasks-list");
					// let tasksLeft = Array.from(fromList.children).filter(
					//   (c) => c.classList && c.classList.contains("task") && c !== task
					// );
					// if (tasksLeft.length === 0) {
					//   let msg = fromList.querySelector(".empty-msg");
					//   if (msg) msg.style.display = "none";
					// }
				});
				task.addEventListener("dragend", (e) => {
					dragged.style.display = "flex";
					dragged = null;
					// Alle Placeholder entfernen
					document
						.querySelectorAll(".placeholder")
						.forEach((ph) => ph.remove());
					// Alle .empty-msg wieder sichtbar machen (wird ggf. gleich wieder entfernt)
					document.querySelectorAll(".empty-msg").forEach((msg) => {
						msg.style.display = "";
					});
					updateEmptyMessages();
				});
			});

			// Drag Events für Columns
			document
				.querySelectorAll(".board-column")
				.forEach((col, idx, allCols) => {
					let list = col.querySelector(".tasks-list");
					list.addEventListener("dragover", (e) => {
						e.preventDefault();

						if (!dragged) return;
						let fromCol = dragged.closest(".board-column");
						let from = parseInt(fromCol.dataset.index);
						if (Math.abs(idx - from) !== 1) return; // nur benachbarte Spalten

						if (!list.querySelector(".placeholder")) {
							list.appendChild(placeholderTemplate.cloneNode(true));
						}
						let msg = list.querySelector(".empty-msg");
						if (msg) msg.style.display = "none";
					});

					// list.addEventListener("dragleave", (e) => {
					//   let related = e.relatedTarget;
					//   if (!list.contains(related)) {
					//     let ph = list.querySelector(".placeholder");
					//     if (ph) ph.remove();
					//     updateEmptyMessages();
					//   }
					// });

					list.addEventListener("drop", (e) => {
						e.preventDefault();
						if (!dragged) return;
						let fromCol = dragged.closest(".board-column");
						let from = parseInt(fromCol.dataset.index);
						if (Math.abs(idx - from) !== 1) return;

						let ph = list.querySelector(".placeholder");
						if (ph) {
							list.insertBefore(dragged, ph);
							ph.remove();
						} else {
							list.appendChild(dragged);
						}
						updateEmptyMessages();
					});
				});
		</script>
	</body>
</html>
